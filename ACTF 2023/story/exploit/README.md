# story

Key point: SSTI, random number prediction

* In the `/vip` routing function, we need to send a captcha that is equal to the random number generated by the server to become a VIP. However, the seed of random numbers are fixed, so we can generate the same sequence of random numbers by calling the same method.
* After becoming a VIP, we can request `/write` routing to write the `story` value in the session. And the `story` value is used to render a template, causing an SSTI vulnerability. However, the entered `story` value will be filtered by a WAF. The WAF randomly uses one of the six rules to filter `story` value, so we can build a payload based on the simplest rule and send it multiple times. The final payload is as follows:

```python
{"story":"{{lipsum|attr('__globals__')|attr('__getit'+'em__')('os')|attr('popen')('cat flag')|attr('read')()}}"}
```

## Another solution

We can obtain the value of the global variable `config` through the SSTI vulnerability, which includes `SECRET_KEY` for encrypting sessions. Then we can forge the value of the `story` in a session to bypass the WAF.
